<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jim Bence">
<meta name="dcterms.date" content="2023-12-04">

<title>Syllabus</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="MLEsoft_syllabus_files/libs/clipboard/clipboard.min.js"></script>
<script src="MLEsoft_syllabus_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="MLEsoft_syllabus_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="MLEsoft_syllabus_files/libs/quarto-html/popper.min.js"></script>
<script src="MLEsoft_syllabus_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MLEsoft_syllabus_files/libs/quarto-html/anchor.min.js"></script>
<link href="MLEsoft_syllabus_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MLEsoft_syllabus_files/libs/quarto-html/quarto-syntax-highlighting-f1f3b3fd89b16212fde59a2af78f1759.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MLEsoft_syllabus_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MLEsoft_syllabus_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MLEsoft_syllabus_files/libs/bootstrap/bootstrap-7af553ea1e1782c9b05323fa0700844c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#course-and-instructor-information" id="toc-course-and-instructor-information" class="nav-link active" data-scroll-target="#course-and-instructor-information"><span class="header-section-number">1</span> Course and Instructor Information</a>
  <ul class="collapse">
  <li><a href="#instructor-jim-bence" id="toc-instructor-jim-bence" class="nav-link" data-scroll-target="#instructor-jim-bence"><span class="header-section-number">1.1</span> Instructor: Jim Bence</a></li>
  <li><a href="#class-times-and-location" id="toc-class-times-and-location" class="nav-link" data-scroll-target="#class-times-and-location"><span class="header-section-number">1.2</span> Class Times and Location:</a></li>
  <li><a href="#course-description" id="toc-course-description" class="nav-link" data-scroll-target="#course-description"><span class="header-section-number">1.3</span> Course Description</a></li>
  <li><a href="#recommended-texts-other-readings" id="toc-recommended-texts-other-readings" class="nav-link" data-scroll-target="#recommended-texts-other-readings"><span class="header-section-number">1.4</span> Recommended Texts &amp; Other Readings</a></li>
  <li><a href="#course-requirements" id="toc-course-requirements" class="nav-link" data-scroll-target="#course-requirements"><span class="header-section-number">1.5</span> Course Requirements</a></li>
  <li><a href="#recommended-background" id="toc-recommended-background" class="nav-link" data-scroll-target="#recommended-background"><span class="header-section-number">1.6</span> Recommended Background</a></li>
  <li><a href="#course-structure-and-accessing-class-materials" id="toc-course-structure-and-accessing-class-materials" class="nav-link" data-scroll-target="#course-structure-and-accessing-class-materials"><span class="header-section-number">1.7</span> Course Structure and accessing class materials</a></li>
  <li><a href="#technical-assistance" id="toc-technical-assistance" class="nav-link" data-scroll-target="#technical-assistance"><span class="header-section-number">1.8</span> Technical Assistance</a></li>
  </ul></li>
  <li><a href="#course-objectives-and-learning-outcomes" id="toc-course-objectives-and-learning-outcomes" class="nav-link" data-scroll-target="#course-objectives-and-learning-outcomes"><span class="header-section-number">2</span> Course Objectives and Learning Outcomes</a></li>
  <li><a href="#course-outlineschedule" id="toc-course-outlineschedule" class="nav-link" data-scroll-target="#course-outlineschedule"><span class="header-section-number">3</span> Course Outline/Schedule</a></li>
  <li><a href="#course-engagement-and-evaluation" id="toc-course-engagement-and-evaluation" class="nav-link" data-scroll-target="#course-engagement-and-evaluation"><span class="header-section-number">4</span> Course Engagement and Evaluation</a></li>
  <li><a href="#course-policies" id="toc-course-policies" class="nav-link" data-scroll-target="#course-policies"><span class="header-section-number">5</span> Course Policies</a>
  <ul class="collapse">
  <li><a href="#communication-and-openness" id="toc-communication-and-openness" class="nav-link" data-scroll-target="#communication-and-openness"><span class="header-section-number">5.1</span> Communication and Openness</a></li>
  <li><a href="#diversity-equity-and-inclusiveness" id="toc-diversity-equity-and-inclusiveness" class="nav-link" data-scroll-target="#diversity-equity-and-inclusiveness"><span class="header-section-number">5.2</span> Diversity Equity and Inclusiveness</a></li>
  <li><a href="#commit-to-integrity-academic-honesty" id="toc-commit-to-integrity-academic-honesty" class="nav-link" data-scroll-target="#commit-to-integrity-academic-honesty"><span class="header-section-number">5.3</span> Commit to Integrity: Academic Honesty</a></li>
  <li><a href="#accommodations" id="toc-accommodations" class="nav-link" data-scroll-target="#accommodations"><span class="header-section-number">5.4</span> Accommodations</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Syllabus</h1>
<p class="subtitle lead">Software for Maximum Likelihood (RTMB version)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jim Bence </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">4 December 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="course-and-instructor-information" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="course-and-instructor-information"><span class="header-section-number">1</span> Course and Instructor Information</h2>
<section id="instructor-jim-bence" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="instructor-jim-bence"><span class="header-section-number">1.1</span> Instructor: Jim Bence</h3>
<ul>
<li>Quantitative Fisheries Center, Michigan State University<br>
</li>
<li>Office Hours: By appointment (online)<br>
</li>
<li>E-mail: bence@msu.edu</li>
</ul>
</section>
<section id="class-times-and-location" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="class-times-and-location"><span class="header-section-number">1.2</span> Class Times and Location:</h3>
<ul>
<li>Tuesday-Friday 10am - 12:30pm EST December 5-15<br>
</li>
<li>All sessions virtual (online) via Zoom via link information sent by email (if you need the link contact instructor).</li>
</ul>
</section>
<section id="course-description" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="course-description"><span class="header-section-number">1.3</span> Course Description</h3>
<p>The course reviews probability theory and concepts and covers applications of fitting models by maximum likelihood using Template Model Builder (TMB) through RTMB. &nbsp;RTMB is an R package that allows you to use TMB, a modern software tool for fitting of nonlinear and non-normal statistical models. TMB is particularly useful for models with random effects, including state space models, and is increasingly being used in fishery stock assessments, spatial models, and fitting of other ecological models. Developing models in TMB requires some knowledge of C++, but by using RTMB you can use TMB without learning C++ coding, although you will need to do computer programming in R.&nbsp; My general expectation is you will have R and R-studio on your computer with the RTMB package installed. In general this should be straight-forward but if you run in to problems contact either the instructor or Charlie Belinsky (tech support). The class is synchronous and online.&nbsp; There will be eight class meetings, each 2.5 hours in length. There is an expectation that students will review materials outside of lecture before the next lecture. While there will not be an excessive amount of outside work students should plan on ~ 1-2 hours after each session.</p>
<section id="technology-requirements" class="level4" data-number="1.3.1">
<h4 data-number="1.3.1" class="anchored" data-anchor-id="technology-requirements"><span class="header-section-number">1.3.1</span> Technology requirements</h4>
<p>The course will be taught using R Studio, R, TMB, and RTMB.&nbsp; TMB will be automatically installed when you install the RTMB package. This software is all freely available.</p>
</section>
</section>
<section id="recommended-texts-other-readings" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="recommended-texts-other-readings"><span class="header-section-number">1.4</span> Recommended Texts &amp; Other Readings</h3>
<p>Links or references to all materials will be provided in the course or will be available through the MSU library. Students in the course will be provided guest access to the MSU library.</p>
</section>
<section id="course-requirements" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="course-requirements"><span class="header-section-number">1.5</span> Course Requirements</h3>
<p>Laptop with a broadband internet connection</p>
</section>
<section id="recommended-background" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="recommended-background"><span class="header-section-number">1.6</span> Recommended Background</h3>
<p>There are no specific prerequisites but a college level statistics course and basic familiarity with R would be beneficial.</p>
</section>
<section id="course-structure-and-accessing-class-materials" class="level3" data-number="1.7">
<h3 data-number="1.7" class="anchored" data-anchor-id="course-structure-and-accessing-class-materials"><span class="header-section-number">1.7</span> Course Structure and accessing class materials</h3>
<p>Material will be presented in lecture/demo format via zoom, with hands on working sessions in breakout zoom rooms. These zoom rooms will allow the instructor to simulate like checking in with a few students at a time as exercises are worked on. Because the course materials are publically accessible, for security reasons the zoom link is not included here but is sent to enrolled students by email.</p>
<p>The course material will be available through a public GitHub site:</p>
<p><a href="https://github.com/QFCatMSU/MLE-Software" class="uri">https://github.com/QFCatMSU/MLE-Software</a></p>
<p>Lectures will be recorded and loaded to:</p>
<p><a href="https://mediaspace.msu.edu/channel/channelid/324238162" class="uri">https://mediaspace.msu.edu/channel/channelid/324238162</a></p>
<p>To access the recordings you will need your MSU ID/Guest Account</p>
<p>Prior to the course start you should have signed up for a guest ID for your email account. This is needed to allow you to access to the course media space (recording site) and to provide you library access.</p>
</section>
<section id="technical-assistance" class="level3" data-number="1.8">
<h3 data-number="1.8" class="anchored" data-anchor-id="technical-assistance"><span class="header-section-number">1.8</span> Technical Assistance</h3>
<p>If you need technical assistance during the course or to report a problem you can:</p>
<ul>
<li>Contact Charlie at <a href="mailto:belinsky@msu.edu">belinsky@msu.edu</a> (QFC academic specialist)</li>
<li>Visit the MSU IT Help &amp; Support Site (<a href="https://tech.msu.edu/support/help/" class="uri">https://tech.msu.edu/support/help/</a>), call (517) 432-6200 or toll free (844) 678-6200, or email ithelp@msu.edu. Note: MSU IT is available 24/7.</li>
<li>Visit the MSU Libraries Discovery Services Site (<a href="https://lib.msu.edu/dls/" class="uri">https://lib.msu.edu/dls/</a>)</li>
<li>Resource Center for Persons with Disabilities (RCPD)
<ul>
<li>To make an appointment with a specialist, contact (517) 353-9642 or TTY: (517) 355-1293</li>
<li>RCPD Get Started Info: <a href="https://www.rcpd.msu.edu/get-started" class="uri">https://www.rcpd.msu.edu/get-started</a></li>
</ul></li>
</ul>
</section>
</section>
<section id="course-objectives-and-learning-outcomes" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="course-objectives-and-learning-outcomes"><span class="header-section-number">2</span> Course Objectives and Learning Outcomes</h2>
<p>The primary learning objectives for this course are: - Develop basic background on the theory of maximum likelihood estimation including underlying probability and treatment of random effects, learn how numerical searches operate to find maximum likelihood estimates, learn about different approaches for assessing uncertainty associated with parameter estimates and quantities calculated from them, learn about how TMB operates, learn how to structure an estimation model in RTMB.</p>
<p><strong>Learning outcomes:</strong></p>
<p>By successfully completing this course, you should be able to:</p>
<ul>
<li><p>Fit nonlinear models in RTMB assuming a range of different univariate and multivariate probability distributions</p></li>
<li><p>Fit models in RTMB that allow for random effects</p></li>
<li><p>Be able to assess uncertainty in through both asymptotic standard errors, profile likelihood confidence intervals, and by simulation</p></li>
<li><p>Understand the basic process of developing RTMB applications to arbitrarily complex alternative situations, although actually developing some such applications would require additional study (e.g., to learn about new probability distributions).<br>
</p>
<p>You will meet the objectives listed above through a combination of the following activities in this course:</p></li>
</ul>
<!-- -->
<ul>
<li><p>Attend all class sessions and participate in course activities<br>
</p></li>
<li><p>Come prepared for class sessions by reviewing prior materials and being ready with questions on areas of confusionS<br>
</p>
<p>Presentation materials and recordings of the lecture parts of class essions will be made available to facilitate review. This is not a substitute for attending the interactive class sessions and students are expected to attend all sessions if at all possible and contact the instructor when a class cannot be attended.</p></li>
</ul>
</section>
<section id="course-outlineschedule" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="course-outlineschedule"><span class="header-section-number">3</span> Course Outline/Schedule</h2>
<p>Important Note: This is only a preliminary plan and will be adjusted based on presentation expeirence and input from students. Refer to the course GitHub page and revieew recordings to stay up to date on what is happening if you must miss a session.</p>
<ul>
<li>Session 1: Introduction
<ul>
<li>Introductions, statistical inference essentials, probability theory, what is maximum likelihood estimation.</li>
<li>Some basics of R for those who need it (loops, functions)</li>
<li>Hands on exercise in calculating the likelihood</li>
<li>The regression case (distinction of estimated and distributional parameters)</li>
<li>Ways of finding maximum likelihood estimates and basics of what RTMB does</li>
</ul></li>
<li>Session 2: First use of RTMB and Derivatives
<ul>
<li>Walk through and modification of really simple RTMB program</li>
<li>Derivatives in more detail</li>
<li>Numerical searches and use of derivatives in searches and assessing uncertainty</li>
<li></li>
</ul></li>
<li>Session 2.
<ul>
<li>Theory and practice fitting a nonlinear regression using RTMB.</li>
<li>Asymptotic standard errors and profile confidence intervals.</li>
<li>Using distributions other than normal</li>
<li>Example nonlinear regression by RTMB and modifications</li>
</ul></li>
<li>Session 3.
<ul>
<li>Turning parameters off (not estimated) or on.</li>
<li>Bounds</li>
<li>More on uncertainty assessment in RTMB</li>
</ul></li>
<li>Session 3b.
<ul>
<li>Additional examples of fitting models with different distributions (how many depends on how things progress)</li>
</ul></li>
<li>Session 4.
<ul>
<li>Theory for random effects</li>
<li>Specifying random effects in RTMB</li>
<li>Worked example with a simple random effects</li>
</ul></li>
<li>Session 5.
<ul>
<li>Simulation in presence of random effects in RTMB</li>
<li>Hands on work doing a complete simulation study</li>
</ul></li>
<li>Session 6.
<ul>
<li>A state space example and its implementation in RTMB</li>
<li>The multivariate normal distribution and its implementation in RTMB</li>
</ul></li>
<li>Sessions 7 and 8 will focus more on hands on applications and increasing exposure to range of models. It is likely that sessions 1-6 will not each be completed in a day so its uncertain how much more material will be presented here.</li>
</ul>
</section>
<section id="course-engagement-and-evaluation" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="course-engagement-and-evaluation"><span class="header-section-number">4</span> Course Engagement and Evaluation</h2>
<p>This is a non-credit ungraded course. The instructor will provide certificates of completion for students who actively participate in the course, and cover all course material. Students who do not attend all sessions (or make arrangements with instructor to make sure they learn that material), or who do not engage in excercises and demonstrate that they are learning the material will not be awarded certificates of completion.</p>
</section>
<section id="course-policies" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="course-policies"><span class="header-section-number">5</span> Course Policies</h2>
<section id="communication-and-openness" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="communication-and-openness"><span class="header-section-number">5.1</span> Communication and Openness</h3>
<p>The coverage of materials will be adaptive and responsive to needs and input expressed by students. I can only do this effectively if you communicate what you understand and what needs more or different coverage. I also cannot cover additional topics of interest to you unless you let me know!</p>
</section>
<section id="diversity-equity-and-inclusiveness" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="diversity-equity-and-inclusiveness"><span class="header-section-number">5.2</span> Diversity Equity and Inclusiveness</h3>
<p>Diversity, Equity and Inclusion are important, interdependent components of everyday life and are critical to our pursuit of academic excellence. Our aim is to foster a culture where every one feels valued, supported and inspired. This includes providing opportunity and access for all people across differences of race, age, color, ethnicity, gender, sexual orientation, gender identity, gender expression, religion, national origin, migratory status, disability / abilities, political affiliation, veteran status and socioeconomic background. This statement is adapted from the college statement within which the QFC sits (See the full college statement: <a href="https://www.canr.msu.edu/news/canr-statement-on-diversity-equity-and-inclusion" class="uri">https://www.canr.msu.edu/news/canr-statement-on-diversity-equity-and-inclusion</a>)</p>
</section>
<section id="commit-to-integrity-academic-honesty" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="commit-to-integrity-academic-honesty"><span class="header-section-number">5.3</span> Commit to Integrity: Academic Honesty</h3>
<p>Article 2.3.3 of the Academic Freedom Report states that “The student shares with the faculty the responsibility for maintaining the integrity of scholarship, grades, and professional standards.” In addition, the Fisheries and Wildlife Deaprtment adheres to the policies on academic honesty as specified in General Student Regulations 1.0, Protection of Scholarship and Grades; the all-University Policy on Integrity of Scholarship and Grades; and Ordinance 17.00, Examinations. (See <a href="https://spartanexperiences.msu.edu/about/handbook/index.html">Spartan Life: Student Handbook and Resource Guide</a>.</p>
</section>
<section id="accommodations" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="accommodations"><span class="header-section-number">5.4</span> Accommodations</h3>
<p>Inform Your Instructor of Any Accommodations Needed</p>
<p>From the Resource Center for Persons with Disabilities (RCPD): Michigan State University is committed to providing equal opportunity for participation in all programs, services and activities. Requests for accommodations by persons with disabilities may be made by contacting the Resource Center for Persons with Disabilities at 517-884-RCPD or on the web at <a href="http://rcpd.msu.edu" class="uri">http://rcpd.msu.edu</a>.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>